<app-events-menu
  [categories]="categories()"
  (categorySelected)="onCategorySelected($event)"
></app-events-menu>

<!-- Sezione Filtri -->
<div
  class="bg-base-200 mt-6 mb-4 flex flex-col w-full max-w-full p-3 sm:p-6 rounded-2xl gap-3 sm:gap-4 overflow-hidden"
>
  <h3 class="text-lg font-semibold">Filtri</h3>
  <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 w-full">
    <!-- Filtro Data -->
    <label class="form-control flex flex-col flex-1 min-w-0">
      <div class="label">
        <span class="label-text">Data evento</span>
      </div>
      <input
        type="date"
        class="input input-md w-full"
        [value]="dateFilter()"
        (input)="onDateFilterChange($event)"
      />
    </label>

    <!-- Filtro Disponibilità -->
    <label class="form-control flex flex-col flex-1 min-w-0">
      <div class="label">
        <span class="label-text">Disponibilità posti</span>
      </div>
      <select
        class="select select-md w-full"
        [value]="availabilityFilter()"
        (change)="onAvailabilityFilterChange($event)"
      >
        <option value="all">Tutti</option>
        <option value="available">Disponibili</option>
        <option value="full">Esauriti</option>
      </select>
    </label>

    <!-- Ordinamento -->
    <label class="form-control flex flex-col flex-1 min-w-0">
      <div class="label">
        <span class="label-text">Ordina per</span>
      </div>
      <select
        class="select select-md w-full"
        [value]="sortOrder()"
        (change)="onSortOrderChange($event)"
      >
        <option value="date-asc">Data (più vicini)</option>
        <option value="date-desc">Data (più lontani)</option>
        <option value="availability">Disponibilità</option>
      </select>
    </label>
  </div>

  <!-- Pulsante Reset Filtri -->
  <div class="flex justify-end">
    <app-button [variant]="'ghost'" [size]="'sm'" (click)="clearFilters()">
      Cancella filtri
    </app-button>
  </div>
</div>

<div class="flex justify-between mt-10">
  <h2 class="text-2xl font-bold">Eventi Disponibili ({{ filteredEvents().length }})</h2>
  @if(isAdmin){<app-button (click)="onNewEvent()">Nuovo Evento</app-button>}
</div>
@if(paginatedEvents().length) {
<div
  class="grid gap-6 my-6"
  [ngClass]="{
    'grid-cols-1': paginatedEvents().length === 1,
    'grid-cols-1 sm:grid-cols-2 lg:grid-cols-2': paginatedEvents().length === 2,
    'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4': paginatedEvents().length >= 3
  }"
>
  @for (event of paginatedEvents(); track event.id) {
  <app-event-card
    [eventData]="event"
    (eventBooked)="onEventBooked()"
    (isEditing)="onEditEvent($event)"
  ></app-event-card>
  }
</div>

<!-- Pagination Controls -->
<app-paginator
  [currentPage]="currentPage()"
  [totalPages]="totalPages()"
  (pageChange)="goToPage($event)"
></app-paginator>

} @else {
<div class="alert alert-info my-6">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    class="h-6 w-6 shrink-0 stroke-current"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
    ></path>
  </svg>
  <span>Nessun evento trovato con i filtri selezionati.</span>
</div>
} @if(unavailableEvents().length) {
<hr />
<h3 class="text-2xl font-bold mt-10">Eventi Non Disponibili</h3>
<div
  class="grid gap-6 my-6"
  [ngClass]="{
    'grid-cols-1': unavailableEvents().length === 1,
    'grid-cols-1 sm:grid-cols-2 lg:grid-cols-2': unavailableEvents().length === 2,
    'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4': unavailableEvents().length >= 3
  }"
>
  @for (event of unavailableEvents(); track event.id) {
  <app-event-card
    [eventData]="event"
    (eventBooked)="onEventBooked()"
    (isEditing)="onEditEvent($event)"
    [unavailable]="true"
  ></app-event-card>
  }
</div>
}
<app-modal [open]="showModal()" [size]="'xl'" (closed)="showModal.set(false)">
  <div modal-header class="font-bold text-lg">
    @if(isEditing()) { Modifica Evento } @else { Crea Nuovo Evento }
  </div>
  <app-event-form
    [eventData]="eventData()"
    [categories]="categories()"
    (onClose)="showModal.set(false)"
    (formSubmitted)="onNewEventCreated()"
  ></app-event-form>
</app-modal>
