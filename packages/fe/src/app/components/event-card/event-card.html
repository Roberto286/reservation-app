<div class="card card-sm bg-base-100 shadow-md w-full max-w-lg border border-base-300">
  <figure class="h-44 w-full overflow-hidden bg-base-200">
    <img
      class="h-full w-full object-cover"
      [src]="placeholderImage"
      alt="Immagine evento"
      loading="lazy"
    />
  </figure>
  <div class="card-body gap-3.5">
    <div class="flex items-start justify-between gap-2.5">
      <div>
        <h2 class="card-title text-base-content text-base" [textContent]="eventData().title"></h2>
        <p class="text-xs text-base-content/70" [textContent]="locationLabel()"></p>
      </div>
      @if (isUpcoming()) {
      <div class="badge badge-secondary uppercase text-xs tracking-wide">Upcoming</div>
      }
    </div>

    @if (eventData().description?.trim()?.length) {
    <div class="flex items-start gap-2">
      <p class="text-xs leading-relaxed text-base-content/80 flex-1" [textContent]="truncatedDescription()"></p>
      @if (eventData().description && eventData().description!.length > 150) {
      <div class="tooltip tooltip-left" [attr.data-tip]="eventData().description">
        <button type="button" class="btn btn-circle btn-ghost btn-xs text-info">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            class="h-4 w-4 stroke-current"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
        </button>
      </div>
      }
    </div>
    }

    <div class="grid gap-1.5 text-xs">
      <div class="flex items-center gap-2">
        <span class="font-semibold text-base-content">Inizio:</span>
        <span class="text-base-content/80" [textContent]="eventDates().start"></span>
      </div>
      <div class="flex items-center gap-2">
        <span class="font-semibold text-base-content">Fine:</span>
        <span class="text-base-content/80" [textContent]="eventDates().end"></span>
      </div>
      <div class="flex items-center gap-2">
        <span class="font-semibold text-base-content">Organizzatore:</span>
        <span class="text-base-content/80" [textContent]="organizerEmail()"></span>
      </div>
    </div>

    <div
      class="card-actions flex-col gap-2.5 pt-1.5 sm:flex-row sm:items-center sm:justify-between"
    >
      <div class="flex flex-wrap gap-1.5">
        <span class="badge badge-outline text-xs" [textContent]="categoryLabel()"></span>
        @if (tags().length > 0) { @for (tag of tags(); track tag) {
        <span class="badge badge-dash badge-info text-xs" [textContent]="tag"></span>
        } }
      </div>
      <div class="text-xs text-base-content/80">
        Posti disponibili:
        <span class="font-semibold text-base-content" [textContent]="availableSeats()"></span>
        <span
          class="text-base-content/60"
          [textContent]="' / ' + eventData().maxParticipants"
        ></span>
      </div>
    </div>

    <div
      class="card-actions mt-1.5 flex flex-col gap-1.5 sm:flex-row sm:items-center sm:justify-between"
    >
      <div
        class="text-xs text-base-content/60"
        [textContent]="'Aggiornato: ' + eventDates().updatedAt"
      ></div>
      @if (isAdmin) {
      <div class="flex items-center gap-1.5">
        <app-button [size]="'sm'" [variant]="'accent'" (click)="onEditEvent()">
          Modifica Evento
        </app-button>
      </div>
      } @else {
      <div class="flex items-center gap-1.5">
        @if (hasAlreadyBooked()) {
        <p class="text-info text-xs font-semibold">Hai gi√† prenotato questo evento</p>
        } @else {
        <select
          class="select select-primary select-sm"
          [disabled]="!canBook()"
          [value]="selectedSeats()"
          (change)="onSeatsChange($event)"
        >
          @for (seats of seatsOptions(); track seats) {
          <option
            [value]="seats"
            [textContent]="seats + (seats === 1 ? ' posto' : ' posti')"
          ></option>
          }
        </select>
        <button
          class="btn btn-primary btn-sm"
          type="button"
          [disabled]="!canBook()"
          (click)="bookSeats()"
        >
          @if (bookingState() === 'loading') {
          <span class="loading loading-spinner loading-xs"></span>
          Prenotazione... } @else { Prenota }
        </button>
        }
      </div>
      } @if (bookingState() === 'success') {
      <p class="text-success text-xs" aria-live="polite">Prenotazione registrata!</p>
      } @else if (bookingState() === 'error' && bookingError()) {
      <p class="text-error text-xs" aria-live="assertive" [textContent]="bookingError()"></p>
      }
    </div>
  </div>
</div>
